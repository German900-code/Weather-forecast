(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))$(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&$(f)}).observe(document,{childList:!0,subtree:!0});function m(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function $(a){if(a.ep)return;a.ep=!0;const r=m(a);fetch(a.href,r)}})();window.addEventListener("DOMContentLoaded",()=>{const p="88c057707d74f6bfbd93b6abc0b83f46",y="https://api.openweathermap.org/data/2.5/weather",m=document.getElementById("input"),$=document.getElementById("search-btn");let a=document.getElementById("city"),r=document.getElementById("temperature"),f=document.getElementById("wind"),T=document.getElementById("humidity"),D=document.getElementById("sunrise"),S=document.getElementById("sunset"),W=document.getElementById("air-quality"),H=document.getElementById("uv-index"),O=document.getElementById("main-img"),q=document.getElementById("weather-text"),U=document.getElementById("todays-data");const j=document.getElementById("button2-days"),k=document.getElementById("button7-days");let c;function x(e){return e.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function I(e,t){const o=e+t;return new Date(o*1e3).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}async function L(e){let o=await(await fetch(`${y}?q=${e}&appid=${p}&units=metric`)).json();c=o,console.log(c);const i=c.coord.lat,n=c.coord.lon;A(i,n),V(i,n),_(e);const l=await P(i,n);if(F(e,l),o.cod==="404"){alert("Error, please enter a correct city name");return}if(console.log(`Пользователь ввёл город: ${m.value}`),e&&isNaN(e)){const d=x(e.trim());a.textContent=`${d}, ${c.sys.country}`}else m.value="Invalid value";r.textContent=Math.round(c.main.temp)+"°C",D.textContent=`Sunrise - ${I(c.sys.sunrise,c.timezone)}`,S.textContent=`Sunset - ${I(c.sys.sunset,c.timezone)}`,f.textContent=`Wind speed - ${Math.round(c.wind.speed)} km/h`,T.textContent=`Humidity - ${c.main.humidity}%`,q.textContent=`${x(c.weather[0].description)}`,O.src=`/Weather-forecast/images/${N(o.weather[0].main)}`}function N(e){switch(e){case"Clear":return"sun-img.svg";case"Clouds":return"clouds-img.svg";case"Rain":return"rain-img.svg";case"Haze":case"Fog":return"fog-img.svg";default:return"sun-img.svg"}}async function M(e){const t=`https://api.openweathermap.org/geo/1.0/direct?q=${e}&limit=1&appid=${p}`,i=await(await fetch(t)).json();if(!i||i.length===0)throw new Error("City not found");return{lat:i[0].lat,lon:i[0].lon}}async function P(e,t){const o=`https://timeapi.io/api/time/current/coordinate?latitude=${e}&longitude=${t}`,n=await(await fetch(o)).json();if(n.dateTime){const l=new Date(n.dateTime);return U.textContent=`${n.dayOfWeek}, ${n.date} - ${n.time}`,l}else throw new Error("Error fetching timezone data")}const B={0:"sun-img.svg",1:"sun-behind-clouds-img.svg",2:"clouds-img.svg",3:"clouds-img.svg",45:"fog-img.svg",48:"fog-img.svg",51:"drizzle-img.svg",53:"drizzle-img.svg",55:"drizzle-img.svg",56:"drizzle-img.svg",57:"drizzle-img.svg",61:"rain-img.svg",63:"rain-img.svg",65:"rain-img.svg",66:"rain-img.svg",67:"rain-img.svg",71:"snowing-img.svg",73:"snowing-img.svg",75:"snowing-img.svg",77:"snowing-img.svg",80:"rain-img.svg",81:"rain-img.svg",82:"rain-img.svg",85:"snowing-img.svg",86:"snowing-img.svg",95:"thunderstorm-img.svg",96:"thunderstorm-img.svg",99:"thunderstorm-img.svg"};async function F(e,t){const{lat:o,lon:i}=await M(e),n=`https://api.open-meteo.com/v1/forecast?latitude=${o}&longitude=${i}&hourly=temperature_2m,precipitation,weathercode&timezone=auto`,d=await(await fetch(n)).json(),s=d.hourly.time,g=d.hourly.temperature_2m,h=d.hourly.weathercode,b=document.querySelector(".additional__hourly");b.innerHTML="";const w=s.findIndex(u=>new Date(u)>t);if(w===-1){console.warn("Нет данных не ближайшие часы");return}for(let u=w;u<Math.min(w+6,s.length);u++){const C=new Date(s[u]).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),E=h[u],v=`/Weather-forecast/images/${B[E]||"sun-img.svg"}`,K=`weather icon ${E}`;new G(C,null,v,K,Math.round(g[u]),".additional__hourly","additional__hourly-item").render()}}async function A(e,t){const n=(await(await fetch(`https://api.openweathermap.org/data/2.5/air_pollution/forecast?lat=${e}&lon=${t}&appid=${p}`)).json()).list[0].main.aqi,l={1:"Good",2:"Fair",3:"Moderate",4:"Poor",5:"Very poor"};W.textContent=`Air Quality - ${n} (${l[n]})`}async function V(e,t){const o=`https://api.openweathermap.org/data/2.5/uvi?lat=${e}&lon=${t}&appid=${p}`;let n=await(await fetch(o)).json(),l=Math.round(n.value);const d={Low:[0,1,2],Moderate:[3,4,5],High:[6,7],"Very High":[8,9,10],Extreme:[11,12,13,14,15]};let s="Unknown";for(let g in d)if(d[g].includes(l)){s=g;break}H.textContent=`UV Index - ${Math.round(n.value)} (${s})`}async function _(e,t=7){const{lat:o,lon:i}=await M(e),n=`https://api.open-meteo.com/v1/forecast?latitude=${o}&longitude=${i}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`,s=(await(await fetch(n)).json()).daily,g=document.querySelector(".sidebar__nextday");if(!s||!s.time){console.warn("Нет данных о днях");return}if(!g){console.log("Ошибка, элемент не найден");return}g.innerHTML="";for(let h=0;h<t;h++){const w=new Date(s.time[h]).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"}),u=s.weathercode[h],C=`/Weather-forecast/images/${B[u]||"sun-img.svg"}`,E=Math.round(s.temperature_2m_max[h]),z=Math.round(s.temperature_2m_min[h]),v=document.createElement("div");v.className="sidebar__nextday-item",v.innerHTML=`
        <img src="${C}" alt="weather icon">
        <div class="sidebar__nextday-descr">
        <p>${w}</p>
        <p>${z}°C / ${E}°C</p>
        </div>`,g.appendChild(v)}}class G{constructor(t,o,i,n,l,d,...s){this.hour=t,this.img=o,this.src=i,this.alt=n,this.temp=l,this.parent=document.querySelector(d),this.classes=s}render(){const t=document.createElement("div");this.classes.length===0?t.classList.add("additional__hourly-item"):this.classes.forEach(o=>t.classList.add(o)),t.innerHTML=`
        <p class="additional__hourly-hour">${this.hour}</p>
        <hr class="line">
        <img class="additional__hourly-img" src=${this.src} alt=${this.alt}>
        <p class="additional__hourly-temp">${this.temp}°C</p>
        `,this.parent.append(t)}}$.addEventListener("click",()=>{const e=m.value.trim();e?L(e):alert("Please enter a city")}),m.addEventListener("keydown",e=>{if(e.key==="Enter"){const t=m.value.trim();t?L(t):alert("Please enter a city")}}),j.addEventListener("click",()=>{const e=m.value.trim();e&&_(e,2)}),k.addEventListener("click",()=>{const e=m.value.trim();e&&_(e,7)})});
