(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))$(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&$(f)}).observe(document,{childList:!0,subtree:!0});function m(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function $(a){if(a.ep)return;a.ep=!0;const c=m(a);fetch(a.href,c)}})();window.addEventListener("DOMContentLoaded",()=>{const p="88c057707d74f6bfbd93b6abc0b83f46",y="https://api.openweathermap.org/data/2.5/weather",m=document.getElementById("input"),$=document.getElementById("search-btn");let a=document.getElementById("city"),c=document.getElementById("temperature"),f=document.getElementById("wind"),D=document.getElementById("humidity"),T=document.getElementById("sunrise"),S=document.getElementById("sunset"),W=document.getElementById("air-quality"),H=document.getElementById("uv-index"),O=document.getElementById("main-img"),q=document.getElementById("weather-text"),P=document.getElementById("todays-data");const U=document.getElementById("button2-days"),j=document.getElementById("button7-days");let l;function I(e){return e.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function x(e,t){const o=e+t;return new Date(o*1e3).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}async function L(e){let o=await(await fetch(`${y}?q=${e}&appid=${p}&units=metric`)).json();l=o,console.log(l);const n=l.coord.lat,i=l.coord.lon;A(n,i),Q(n,i),_(e);const d=await N(n,i);if(F(e,d),o.cod==="404"){alert("Error, please enter a correct city name");return}if(console.log(`Пользователь ввёл город: ${m.value}`),e&&isNaN(e)){const s=I(e.trim());a.textContent=`${s}, ${l.sys.country}`}else m.value="Invalid value";c.textContent=Math.round(l.main.temp)+"°C",T.textContent=`Sunrise - ${x(l.sys.sunrise,l.timezone)}`,S.textContent=`Sunset - ${x(l.sys.sunset,l.timezone)}`,f.textContent=`Wind speed - ${Math.round(l.wind.speed)} km/h`,D.textContent=`Humidity - ${l.main.humidity}%`,q.textContent=`${I(l.weather[0].description)}`,O.src=`/Weather-forecast/images/${k(o.weather[0].main)}`}function k(e){switch(e){case"Clear":return"sun-img.svg";case"Clouds":return"clouds-img.svg";case"Rain":return"rain-img.svg";case"Haze":case"Fog":return"fog-img.svg";default:return"sun-img.svg"}}async function M(e){const t=`https://api.openweathermap.org/geo/1.0/direct?q=${e}&limit=1&appid=${p}`,n=await(await fetch(t)).json();if(!n||n.length===0)throw new Error("City not found");return{lat:n[0].lat,lon:n[0].lon}}async function N(e,t){const o=`https://timeapi.io/api/time/current/coordinate?latitude=${e}&longitude=${t}`,i=await(await fetch(o)).json();if(i.dateTime){const d=new Date(i.dateTime);return P.textContent=`${i.dayOfWeek}, ${i.date} - ${i.time}`,d}else throw new Error("Error fetching timezone data")}const B={0:"sun-img.svg",1:"sun-behind-clouds-img.svg",2:"clouds-img.svg",3:"clouds-img.svg",45:"fog-img.svg",48:"fog-img.svg",51:"drizzle-img.svg",53:"drizzle-img.svg",55:"drizzle-img.svg",56:"drizzle-img.svg",57:"drizzle-img.svg",61:"rain-img.svg",63:"rain-img.svg",65:"rain-img.svg",66:"rain-img.svg",67:"rain-img.svg",71:"snowing-img.svg",73:"snowing-img.svg",75:"snowing-img.svg",77:"snowing-img.svg",80:"rain-img.svg",81:"rain-img.svg",82:"rain-img.svg",85:"snowing-img.svg",86:"snowing-img.svg",95:"thunderstorm-img.svg",96:"thunderstorm-img.svg",99:"thunderstorm-img.svg"};async function F(e,t){const{lat:o,lon:n}=await M(e),i=`https://api.open-meteo.com/v1/forecast?latitude=${o}&longitude=${n}&hourly=temperature_2m,precipitation,weathercode&timezone=auto`,s=await(await fetch(i)).json(),r=s.hourly.time,g=s.hourly.temperature_2m,h=s.hourly.weathercode,b=document.querySelector(".additional__hourly");b.innerHTML="";const w=r.findIndex(u=>new Date(u)>t);if(w===-1){console.warn("Нет данных не ближайшие часы");return}for(let u=w;u<Math.min(w+6,r.length);u++){const C=new Date(r[u]).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),E=h[u],v=`/Weather-forecast/images/${B[E]||"sun-img.svg"}`,K=`weather icon ${E}`;new V(C,null,v,K,Math.round(g[u]),".additional__hourly","additional__hourly-item").render()}}async function A(e,t){let n=await(await fetch(`https://api.openweathermap.org/data/2.5/air_pollution/forecast?lat=${e}&lon=${t}&appid=${p}`)).json();console.log(n);const d=n.list[0].main.aqi,s={1:"Good",2:"Fair",3:"Moderate",4:"Poor",5:"Very poor"};W.textContent=`Air Quality - ${d} (${s[d]})`}async function Q(e,t){const o=`https://api.openweathermap.org/data/2.5/uvi?lat=${e}&lon=${t}&appid=${p}`;let i=await(await fetch(o)).json(),d=Math.round(i.value);const s={Low:[0,1,2],Moderate:[3,4,5],High:[6,7],"Very High":[8,9,10],Extreme:[11,12,13,14,15]};let r="Unknown";for(let g in s)if(s[g].includes(d)){r=g;break}H.textContent=`UV Index - ${Math.round(i.value)} (${r})`}async function _(e,t=7){const{lat:o,lon:n}=await M(e),i=`https://api.open-meteo.com/v1/forecast?latitude=${o}&longitude=${n}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`,s=await(await fetch(i)).json(),r=s.daily,g=document.querySelector(".sidebar__nextday");if(console.log(`Получаем прогноз на ${t} дней`),console.log("Координаты:",o,n),console.log("Ответ от OpenMeteo API:",s),!r||!r.time){console.warn("Нет данных о днях");return}if(!g){console.log("Ошибка, элемент не найден");return}g.innerHTML="";for(let h=0;h<t;h++){const w=new Date(r.time[h]).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"}),u=r.weathercode[h],C=`/Weather-forecast/images/${B[u]||"sun-img.svg"}`,E=Math.round(r.temperature_2m_max[h]),z=Math.round(r.temperature_2m_min[h]),v=document.createElement("div");v.className="sidebar__nextday-item",v.innerHTML=`
        <img src="${C}" alt="weather icon">
        <div class="sidebar__nextday-descr">
        <p>${w}</p>
        <p>${z}°C / ${E}°C</p>
        </div>`,g.appendChild(v)}}class V{constructor(t,o,n,i,d,s,...r){this.hour=t,this.img=o,this.src=n,this.alt=i,this.temp=d,this.parent=document.querySelector(s),this.classes=r}render(){const t=document.createElement("div");this.classes.length===0?t.classList.add("additional__hourly-item"):this.classes.forEach(o=>t.classList.add(o)),t.innerHTML=`
        <p class="additional__hourly-hour">${this.hour}</p>
        <hr class="line">
        <img class="additional__hourly-img" src=${this.src} alt=${this.alt}>
        <p class="additional__hourly-temp">${this.temp}°C</p>
        `,this.parent.append(t)}}$.addEventListener("click",()=>{const e=m.value.trim();e?L(e):alert("Please enter a city")}),m.addEventListener("keydown",e=>{if(e.key==="Enter"){const t=m.value.trim();t?L(t):alert("Please enter a city")}}),U.addEventListener("click",()=>{const e=m.value.trim();e&&_(e,2)}),j.addEventListener("click",()=>{const e=m.value.trim();e&&_(e,7)})});
